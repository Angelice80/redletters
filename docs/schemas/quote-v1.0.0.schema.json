{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://redletters.dev/schemas/quote-v1.0.0.schema.json",
  "title": "Quote Output",
  "description": "Schema for citeable quote output (v0.9.0+)",
  "type": "object",
  "required": [
    "reference",
    "reference_normalized",
    "mode",
    "spine_text",
    "provenance",
    "gate_status",
    "generated_at",
    "schema_version"
  ],
  "properties": {
    "reference": {
      "type": "string",
      "description": "Original scripture reference as provided"
    },
    "reference_normalized": {
      "type": "string",
      "description": "Normalized reference (e.g., 'John.1.1')"
    },
    "mode": {
      "type": "string",
      "description": "Output mode",
      "enum": ["readable", "traceable"]
    },
    "spine_text": {
      "type": "string",
      "description": "Greek text from SBLGNT spine"
    },
    "provenance": {
      "$ref": "#/$defs/provenance"
    },
    "gate_status": {
      "$ref": "#/$defs/gate_status"
    },
    "confidence_summary": {
      "$ref": "#/$defs/confidence_summary"
    },
    "generated_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of generation",
      "format": "date-time"
    },
    "schema_version": {
      "type": "string",
      "description": "Schema version",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    }
  },
  "$defs": {
    "provenance": {
      "type": "object",
      "required": ["packs_used", "session_id"],
      "properties": {
        "packs_used": {
          "type": "array",
          "description": "List of installed pack IDs",
          "items": {
            "type": "string"
          }
        },
        "session_id": {
          "type": "string",
          "description": "Session ID used for gate checking"
        }
      }
    },
    "gate_status": {
      "type": "object",
      "required": ["gates_cleared", "forced_responsibility"],
      "properties": {
        "gates_cleared": {
          "type": "boolean",
          "description": "Whether all gates were acknowledged"
        },
        "forced_responsibility": {
          "type": "boolean",
          "description": "Whether --force was used to bypass pending gates"
        },
        "pending_gates": {
          "type": "array",
          "description": "List of pending gates (only present if forced)",
          "items": {
            "$ref": "#/$defs/pending_gate"
          }
        }
      }
    },
    "pending_gate": {
      "type": "object",
      "required": ["variant_ref", "significance", "spine_reading", "readings_count"],
      "properties": {
        "variant_ref": {
          "type": "string",
          "description": "Reference of the variant"
        },
        "significance": {
          "type": "string",
          "description": "Significance level"
        },
        "spine_reading": {
          "type": "string",
          "description": "SBLGNT reading text"
        },
        "readings_count": {
          "type": "integer",
          "description": "Number of variant readings",
          "minimum": 1
        }
      }
    },
    "confidence_summary": {
      "type": "object",
      "properties": {
        "variants_in_scope": {
          "type": "integer",
          "description": "Number of variants in this reference",
          "minimum": 0
        },
        "significance_breakdown": {
          "type": "object",
          "description": "Counts by significance level",
          "additionalProperties": {
            "type": "integer"
          }
        }
      }
    }
  }
}

{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://redletters.dev/schemas/snapshot-v1.0.0.schema.json",
  "title": "Reproducibility Snapshot",
  "description": "Schema for reproducibility snapshot (v0.5.0+, v0.10.0 adds schema_versions, v0.11.0 adds lockfile_hash)",
  "type": "object",
  "required": [
    "tool_version",
    "schema_version",
    "timestamp",
    "packs",
    "export_hashes"
  ],
  "properties": {
    "tool_version": {
      "type": "string",
      "description": "Version of the redletters tool",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "schema_version": {
      "type": "string",
      "description": "Schema version for this snapshot",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "git_commit": {
      "type": ["string", "null"],
      "description": "Git commit hash if in a git repository",
      "pattern": "^[0-9a-f]{40}$"
    },
    "timestamp": {
      "type": "string",
      "description": "ISO 8601 timestamp of snapshot generation",
      "format": "date-time"
    },
    "packs": {
      "type": "array",
      "description": "List of installed packs",
      "items": {
        "$ref": "#/$defs/pack_info"
      }
    },
    "export_hashes": {
      "type": "object",
      "description": "Map of filename to SHA-256 hash",
      "additionalProperties": {
        "type": "string",
        "pattern": "^[0-9a-f]{64}$"
      }
    },
    "confidence_bucketing_version": {
      "type": "string",
      "description": "Version of the confidence bucketing algorithm (v0.8.0)",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "schema_versions": {
      "type": "object",
      "description": "Schema versions for all artifact types (v0.10.0)",
      "additionalProperties": {
        "type": "string",
        "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
      }
    },
    "lockfile_hash": {
      "type": ["string", "null"],
      "description": "SHA-256 hash of pack lockfile for integrity verification (v0.11.0)",
      "pattern": "^[0-9a-f]{64}$"
    }
  },
  "$defs": {
    "pack_info": {
      "type": "object",
      "required": ["pack_id", "version", "license"],
      "properties": {
        "pack_id": {
          "type": "string",
          "description": "Unique pack identifier"
        },
        "version": {
          "type": "string",
          "description": "Pack version"
        },
        "license": {
          "type": "string",
          "description": "License identifier"
        },
        "pack_hash": {
          "type": ["string", "null"],
          "description": "SHA-256 hash of pack manifest"
        },
        "install_path": {
          "type": ["string", "null"],
          "description": "Installation path"
        },
        "source_id": {
          "type": "string",
          "description": "Stable citation key (v0.6.0)"
        },
        "source_title": {
          "type": "string",
          "description": "Full bibliographic title (v0.6.0)"
        },
        "edition": {
          "type": "string",
          "description": "Edition string (v0.6.0)"
        },
        "publisher": {
          "type": "string",
          "description": "Publisher name (v0.6.0)"
        },
        "year": {
          "type": ["integer", "null"],
          "description": "Publication year (v0.6.0)"
        },
        "license_url": {
          "type": "string",
          "description": "Link to license text (v0.6.0)"
        },
        "role": {
          "type": "string",
          "description": "Pack role (source_text, sense_pack, etc.)"
        }
      }
    }
  }
}
